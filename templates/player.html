<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playing: {{ file_name }} - LightMedia</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="player-mode">
    <!-- Player Header -->
    <header class="player-header">
        <button class="back-btn" onclick="window.history.back()">
            <i class="fas fa-arrow-left"></i> Back
        </button>
        <h2 class="player-title">{{ file_name }}</h2>
        <div class="player-actions">
            <button class="action-btn" onclick="toggleFullscreen()">
                <i class="fas fa-expand"></i>
            </button>
        </div>
    </header>

    <!-- Media Player -->
    <main class="player-container">
        {% if file_type == 'video' %}
        <video 
            id="media-player" 
            controls 
            autoplay 
            class="media-element"
            oncontextmenu="return false;"
        >
            <source src="/media/{{ file_path }}" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        {% elif file_type == 'audio' %}
        <div class="audio-player">
            <div class="audio-cover">
                <i class="fas fa-music"></i>
            </div>
            <audio 
                id="media-player" 
                controls 
                autoplay 
                class="media-element"
            >
                <source src="/media/{{ file_path }}" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
        </div>
        {% elif file_type == 'image' %}
        <div class="image-viewer">
            <img 
                src="/media/{{ file_path }}" 
                alt="{{ file_name }}" 
                class="media-element"
                onclick="toggleFullscreen()"
            >
        </div>
        {% endif %}

        <!-- Player Controls -->
        <div class="player-controls">
            <div class="control-group">
                <button class="control-btn" onclick="skipBackward()">
                    <i class="fas fa-backward-step"></i> -10s
                </button>
                <button class="control-btn play-btn" onclick="togglePlay()">
                    <i class="fas fa-play" id="play-icon"></i>
                </button>
                <button class="control-btn" onclick="skipForward()">
                    +10s <i class="fas fa-forward-step"></i>
                </button>
            </div>
            
            <div class="progress-container">
                <span id="current-time">0:00</span>
                <input 
                    type="range" 
                    id="progress-bar" 
                    min="0" 
                    max="100" 
                    value="0"
                    oninput="seekMedia(this.value)"
                >
                <span id="duration">0:00</span>
            </div>

            <div class="control-group">
                <button class="control-btn" onclick="changeVolume(-0.1)">
                    <i class="fas fa-volume-low"></i>
                </button>
                <input 
                    type="range" 
                    id="volume-bar" 
                    min="0" 
                    max="1" 
                    step="0.1" 
                    value="1"
                    oninput="setVolume(this.value)"
                >
                <button class="control-btn" onclick="changeVolume(0.1)">
                    <i class="fas fa-volume-high"></i>
                </button>
            </div>
        </div>
    </main>

    <!-- JavaScript -->
    <script>
        const player = document.getElementById('media-player');
        const progressBar = document.getElementById('progress-bar');
        const volumeBar = document.getElementById('volume-bar');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');
        const playIcon = document.getElementById('play-icon');

        // Initialize player
        if (player) {
            player.addEventListener('loadedmetadata', function() {
                durationEl.textContent = formatTime(player.duration);
                volumeBar.value = player.volume;
            });

            player.addEventListener('timeupdate', function() {
                if (player.duration) {
                    const percent = (player.currentTime / player.duration) * 100;
                    progressBar.value = percent;
                    currentTimeEl.textContent = formatTime(player.currentTime);
                }
            });

            player.addEventListener('play', function() {
                playIcon.className = 'fas fa-pause';
            });

            player.addEventListener('pause', function() {
                playIcon.className = 'fas fa-play';
            });

            player.addEventListener('ended', function() {
                playIcon.className = 'fas fa-play';
                player.currentTime = 0;
            });
        }

        function togglePlay() {
            if (player.paused) {
                player.play();
            } else {
                player.pause();
            }
        }

        function seekMedia(percent) {
            if (player.duration) {
                player.currentTime = (percent / 100) * player.duration;
            }
        }

        function setVolume(volume) {
            player.volume = volume;
        }

        function changeVolume(delta) {
            player.volume = Math.max(0, Math.min(1, player.volume + delta));
            volumeBar.value = player.volume;
        }

        function skipBackward() {
            player.currentTime = Math.max(0, player.currentTime - 10);
        }

        function skipForward() {
            player.currentTime = Math.min(player.duration, player.currentTime + 10);
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log('Fullscreen error:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Keyboard controls
        document.addEventListener('keydown', function(e) {
            if (e.key === ' ') {
                e.preventDefault();
                togglePlay();
            } else if (e.key === 'ArrowLeft') {
                skipBackward();
            } else if (e.key === 'ArrowRight') {
                skipForward();
            } else if (e.key === 'ArrowUp') {
                changeVolume(0.1);
            } else if (e.key === 'ArrowDown') {
                changeVolume(-0.1);
            } else if (e.key === 'f') {
                toggleFullscreen();
            } else if (e.key === 'Escape') {
                if (document.fullscreenElement) {
                    document.exitFullscreen();
                }
            }
        });

        // Touch gestures for mobile
        let touchStartX = 0;
        document.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
        });

        document.addEventListener('touchend', e => {
            const touchEndX = e.changedTouches[0].clientX;
            const diffX = touchEndX - touchStartX;

            if (Math.abs(diffX) > 50) {
                if (diffX > 0) {
                    skipBackward();
                } else {
                    skipForward();
                }
            }
        });
    </script>
</body>
</html>